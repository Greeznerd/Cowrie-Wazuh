<!-- Local rules -->

<!-- Modify it at your will. -->
<!-- Copyright (C) 2015, Wazuh Inc. -->

<!-- Example -->
<group name="local,syslog,sshd,">

    <!--
    Dec 10 01:02:02 host sshd[1234]: Failed none for root from 1.1.1.1 port 1066 ssh2
    -->
  <rule id="100001" level="5">
    <if_sid>5716</if_sid>
    <srcip>1.1.1.1</srcip>
    <description>sshd: authentication failed from IP 1.1.1.1.</description>
    <group>authentication_failed,pci_dss_10.2.4,pci_dss_10.2.5,</group>
  </rule>

</group>

<group name="cowrie,honeypot,">

  <rule id="90001" level="6">
    <if_sid>5710</if_sid>
    <program_name>cowrie</program_name>
    <match>login attempt failed</match>
    <description>Cowrie: Failed SSH login attempt</description>
  </rule>

  <rule id="90002" level="10">
    <if_same_source ip="yes">90001</if_same_source>
    <same_source>15</same_source>
    <description>Cowrie: Possible brute-force attack detected</description>
  </rule>

  <rule id="90003" level="12">
    <if_sid>90001</if_sid>
    <match>login attempt succeeded</match>
    <description>Cowrie: Successful login after multiple failures (high risk)</description>
  </rule>

  <rule id="90010" level="5">
    <program_name>cowrie</program_name>
    <regex>command="(uname -a|ls -la|cat /etc/passwd|whoami|ps aux|netstat)"</regex>
    <description>Cowrie: Reconnaissance command executed</description>
    <mitre>
      <id>T1082</id>
      <id>T1087</id>
      <id>T1049</id>
    </mitre>
  </rule>

  <rule id="90011" level="9">
    <program_name>cowrie</program_name>
    <regex>cat /etc/(passwd|shadow)</regex>
    <description>Cowrie: Access to sensitive system file</description>
    <mitre>
      <id>T1003</id>
    </mitre>
  </rule>

  <rule id="90020" level="10">
    <program_name>cowrie</program_name>
    <regex>(wget|curl).*(http|https)://</regex>
    <description>Cowrie: Remote file download attempt detected</description>
    <mitre>
      <id>T1105</id>
    </mitre>
  </rule>

  <rule id="90021" level="12">
    <if_sid>90020</if_sid>
    <regex>(\.ru|\.cn|pastebin|raw.githubusercontent)</regex>
    <description>Cowrie: File download from suspicious or high-risk domain</description>
  </rule>

  <rule id="90030" level="12">
    <program_name>cowrie</program_name>
    <regex>(\/dev\/tcp|nc .* -e|bash -i|python.*socket)</regex>
    <description>Cowrie: Reverse shell attempt detected</description>
    <mitre>
      <id>T1059</id>
      <id>T1105</id>
      <id>T1572</id>
    </mitre>
  </rule>

  <rule id="90040" level="8">
    <program_name>cowrie</program_name>
    <regex>sudo (su|-l)</regex>
    <description>Cowrie: Privilege escalation attempt using sudo</description>
    <mitre>
      <id>T1068</id>
    </mitre>
  </rule>

  <rule id="90041" level="7">
    <program_name>cowrie</program_name>
    <regex>find .* -perm -4000</regex>
    <description>Cowrie: Enumeration of SUID binaries</description>
  </rule>

  <rule id="90050" level="10">
    <program_name>cowrie</program_name>
    <match>uploaded file</match>
    <description>Cowrie: File upload attempt detected</description>
    <mitre>
      <id>T1105</id>
    </mitre>
  </rule>

  <rule id="90051" level="12">
    <if_sid>90050</if_sid>
    <regex>\.(sh|py|exe|bin|php)$</regex>
    <description>Cowrie: Potential malware uploaded to honeypot</description>
  </rule>

</group>
